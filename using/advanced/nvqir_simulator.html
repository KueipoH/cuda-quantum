<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Extending CUDA Quantum with a new Simulator &mdash; NVIDIA CUDA Quantum 0.3 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/cudaq_override.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/_static/cudaq_override.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="CUDA Quantum and CMake" href="cmake_app.html" />
    <link rel="prev" title="Advanced CUDA Quantum Topics" href="../advanced.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" > 

          
          
          <a href="../../index.html" class="icon icon-home">
            NVIDIA CUDA Quantum
          </a>
              <div class="version">
                0.3
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

  <style>
    /* Sidebar header (and topbar for mobile) */
    .wy-side-nav-search, .wy-nav-top {
      background: #76b900;
    }

    .wy-side-nav-search a:link, .wy-nav-top a:link {
      color: #fff;
    }
    .wy-side-nav-search a:visited, .wy-nav-top a:visited {
      color: #fff;
    }
    .wy-side-nav-search a:hover, .wy-nav-top a:hover {
      color: #fff;
    }

    .wy-menu-vertical a:link, .wy-menu-vertical a:visited {
      color: #d9d9d9
    }

    .wy-menu-vertical a:active {
      background-color: #76b900
    }

    .wy-side-nav-search>div.version {
      color: rgba(0, 0, 0, 0.3)
    }

    /* override table width restrictions */
    .wy-table-responsive table td, .wy-table-responsive table th {
        white-space: normal;
    }

    .wy-table-responsive {
        margin-bottom: 24px;
        max-width: 100%;
        overflow: visible;
    }
  </style>
  
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../install.html">   Getting Started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../install.html#docker-image">Docker Image</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../install.html#install-the-public-beta-docker-image">Install the Public Beta Docker Image</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../install.html#use-cuda-quantum-in-a-terminal">Use CUDA Quantum in a Terminal</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../install.html#use-cuda-quantum-in-vs-code">Use CUDA Quantum in VS Code</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../install.html#build-cuda-quantum-from-source">Build CUDA Quantum from Source</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../install.html#get-the-basic-compilers-you-ll-need-via-apt-get">Get the basic compilers you’ll need via apt-get</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../install.html#get-cuquantum-optional">Get cuQuantum (optional)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../install.html#get-llvm-clang-mlir">Get LLVM / Clang / MLIR</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../install.html#build-cuda-quantum">Build CUDA Quantum</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../install.html#next-steps">Next Steps</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../cudaq.html">   Learn the Basics</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../cudaq/prereqs.html">CUDA Quantum Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cudaq/compiling.html">Compiling CUDA Quantum Programs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cudaq/kernel.html">What is a CUDA Quantum Kernel?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cudaq/allocating_quantum_memory.html">Allocating Quantum Memory</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cudaq/runtime_v_compile.html">Runtime Versus Compile-time Kernels</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cudaq/generic_functions.html">Generic Library Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cudaq/builder.html">Creating Kernels at Runtime</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cudaq/variational.html">Variational Algorithms</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cudaq/platform.html">Asynchronous Execution</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cudaq/verbose_out.html">Debugging and Verbose Logging</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../advanced.html">   Advanced Topics</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Create a new NVQIR Simulator</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#circuitsimulator">CircuitSimulator</a></li>
<li class="toctree-l3"><a class="reference internal" href="#let-s-see-this-in-action">Let’s see this in action</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="cmake_app.html">Downstream CMake Integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="cudaq_ir.html">Working with CUDA Quantum IR</a></li>
<li class="toctree-l2"><a class="reference internal" href="mlir_pass.html">Create an MLIR Pass for CUDA Quantum</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../examples.html">   Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../cpp.html">   CUDA Quantum in C++</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../cpp.html#introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cpp.html#computing-expectation-values">Computing Expectation Values</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cpp.html#multi-control-synthesis">Multi-control Synthesis</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cpp.html#simulations-with-cuquantum">Simulations with cuQuantum</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../python.html">   CUDA Quantum in Python</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../python.html#introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../python.html#bernstein-vazirani">Bernstein-Vazirani</a></li>
<li class="toctree-l3"><a class="reference internal" href="../python.html#variational-quantum-eigensolver">Variational Quantum Eigensolver</a></li>
<li class="toctree-l3"><a class="reference internal" href="../python.html#quantum-approximate-optimization-algorithm">Quantum Approximate Optimization Algorithm</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../simulators.html">   Simulator Backends</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../simulators.html#state-vector-simulators">State Vector Simulators</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../simulators.html#cuquantum-single-gpu">cuQuantum single-GPU</a></li>
<li class="toctree-l3"><a class="reference internal" href="../simulators.html#cuquantum-multi-node-multi-gpu">cuQuantum multi-node multi-GPU</a></li>
<li class="toctree-l3"><a class="reference internal" href="../simulators.html#openmp-cpu-only">OpenMP CPU-only</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../simulators.html#tensor-network-simulators">Tensor Network Simulators</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../simulators.html#id1">cuQuantum multi-node multi-GPU</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../specification/index.html">   Specifications</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../specification/cudaq.html">   Language Specification</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../specification/cudaq/machine_model.html">1. Machine Model</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../specification/cudaq/namespace.html">2. Namespace</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../specification/cudaq/types.html">3. Quantum Types</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../specification/cudaq/types.html#cudaq-qudit-levels">3.1. <code class="code docutils literal notranslate"><span class="pre">cudaq::qudit&lt;Levels&gt;</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../specification/cudaq/types.html#cudaq-qubit">3.2. <code class="code docutils literal notranslate"><span class="pre">cudaq::qubit</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../specification/cudaq/types.html#quantum-containers">3.3. Quantum Containers</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../specification/cudaq/operators.html">4. Quantum Operators</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../specification/cudaq/operators.html#cudaq-spin-op">4.1. <code class="code docutils literal notranslate"><span class="pre">cudaq::spin_op</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../specification/cudaq/operations.html">5. Quantum Operations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../specification/cudaq/operations.html#operations-on-cudaq-qubit">5.1. Operations on <code class="code docutils literal notranslate"><span class="pre">cudaq::qubit</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../specification/cudaq/kernels.html">6. Quantum Kernels</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../specification/cudaq/kernels.html#kernel-composability">6.1. Kernel Composability</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../specification/cudaq/kernels.html#allowed-kernel-classical-function-invocations">6.2. Allowed Kernel Classical Function Invocations</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../specification/cudaq/synthesis.html">7. Sub-circuit Synthesis</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../specification/cudaq/control_flow.html">8. Control Flow</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../specification/cudaq/dynamic_kernels.html">9. Just-in-Time Kernel Creation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../specification/cudaq/patterns.html">10. Quantum Patterns</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../specification/cudaq/patterns.html#compute-action-uncompute">10.1. Compute-Action-Uncompute</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../specification/cudaq/platform.html">11. Platform</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../specification/cudaq/algorithmic_primitives.html">12. Algorithmic Primitives</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../specification/cudaq/algorithmic_primitives.html#cudaq-sample">12.1. cudaq::sample</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../specification/cudaq/algorithmic_primitives.html#cudaq-observe">12.2. cudaq::observe</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../specification/cudaq/algorithmic_primitives.html#cudaq-optimizer">12.3. cudaq::optimizer</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../specification/cudaq/algorithmic_primitives.html#cudaq-gradient">12.4. cudaq::gradient</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../specification/cudaq/examples.html">13. Example Programs</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../specification/cudaq/examples.html#hello-world-simple-bell-state">13.1. Hello World - Simple Bell State</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../specification/cudaq/examples.html#ghz-state-preparation-and-sampling">13.2. GHZ State Preparation and Sampling</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../specification/cudaq/examples.html#quantum-phase-estimation">13.3. Quantum Phase Estimation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../specification/cudaq/examples.html#deuteron-binding-energy-parameter-sweep">13.4. Deuteron Binding Energy Parameter Sweep</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../specification/cudaq/examples.html#grover-s-algorithm">13.5. Grover’s Algorithm</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../specification/cudaq/examples.html#iterative-phase-estimation">13.6. Iterative Phase Estimation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../specification/qtx-dialect.html">   QTX Specification</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../specification/qtx-dialect.html#general-introduction">General Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../specification/qtx-dialect.html#motivation">Motivation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../specification/qtx-dialect.html#qtx-types">QTX Types</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../api/api.html">   API Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../api/languages/cpp_api.html">C++ API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/languages/cpp_api.html#operators">Operators</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/languages/cpp_api.html#quantum">Quantum</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/languages/cpp_api.html#common">Common</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/languages/cpp_api.html#noise-modeling">Noise Modeling</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/languages/cpp_api.html#kernel-builder">Kernel Builder</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/languages/cpp_api.html#algorithms">Algorithms</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/languages/cpp_api.html#platform">Platform</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/languages/cpp_api.html#namespaces">Namespaces</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/languages/python_api.html">Python API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/languages/python_api.html#program-construction">Program Construction</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#cudaq.make_kernel"><code class="docutils literal notranslate"><span class="pre">make_kernel()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#cudaq.Kernel"><code class="docutils literal notranslate"><span class="pre">Kernel</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../api/languages/python_api.html#kernel-execution">Kernel Execution</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#cudaq.sample"><code class="docutils literal notranslate"><span class="pre">sample()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#cudaq.sample_async"><code class="docutils literal notranslate"><span class="pre">sample_async()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#cudaq.observe"><code class="docutils literal notranslate"><span class="pre">observe()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#cudaq.observe_async"><code class="docutils literal notranslate"><span class="pre">observe_async()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#cudaq.vqe"><code class="docutils literal notranslate"><span class="pre">vqe()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../api/languages/python_api.html#backend-configuration">Backend Configuration</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#cudaq.set_noise"><code class="docutils literal notranslate"><span class="pre">set_noise()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#cudaq.unset_noise"><code class="docutils literal notranslate"><span class="pre">unset_noise()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#cudaq.set_qpu"><code class="docutils literal notranslate"><span class="pre">set_qpu()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#cudaq.list_qpus"><code class="docutils literal notranslate"><span class="pre">list_qpus()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../api/languages/python_api.html#data-types">Data Types</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#cudaq.QuakeValue"><code class="docutils literal notranslate"><span class="pre">QuakeValue</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#cudaq.qubit"><code class="docutils literal notranslate"><span class="pre">qubit</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#cudaq.qreg"><code class="docutils literal notranslate"><span class="pre">qreg</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#cudaq.SpinOperator"><code class="docutils literal notranslate"><span class="pre">SpinOperator</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#cudaq.spin.i"><code class="docutils literal notranslate"><span class="pre">spin.i()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#cudaq.spin.x"><code class="docutils literal notranslate"><span class="pre">spin.x()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#cudaq.spin.y"><code class="docutils literal notranslate"><span class="pre">spin.y()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#cudaq.spin.z"><code class="docutils literal notranslate"><span class="pre">spin.z()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#cudaq.SampleResult"><code class="docutils literal notranslate"><span class="pre">SampleResult</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#cudaq.AsyncSampleResult"><code class="docutils literal notranslate"><span class="pre">AsyncSampleResult</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#cudaq.ObserveResult"><code class="docutils literal notranslate"><span class="pre">ObserveResult</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#cudaq.AsyncObserveResult"><code class="docutils literal notranslate"><span class="pre">AsyncObserveResult</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#cudaq.OptimizationResult"><code class="docutils literal notranslate"><span class="pre">OptimizationResult</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#optimizers">Optimizers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#gradients">Gradients</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#noisy-simulation">Noisy Simulation</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">NVIDIA CUDA Quantum</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../advanced.html">Advanced CUDA Quantum Topics</a></li>
      <li class="breadcrumb-item active">Extending CUDA Quantum with a new Simulator</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/using/advanced/nvqir_simulator.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="extending-cuda-quantum-with-a-new-simulator">
<h1>Extending CUDA Quantum with a new Simulator<a class="headerlink" href="#extending-cuda-quantum-with-a-new-simulator" title="Permalink to this heading">¶</a></h1>
<p>Backend circuit simulation in CUDA Quantum is enabled via the
NVQIR library (<code class="code docutils literal notranslate"><span class="pre">libnvqir</span></code>). CUDA Quantum code is ultimately lowered
to the LLVM IR in a manner that is adherent to the <a class="reference external" href="https://qir-alliance.org">QIR specification</a>.
NVQIR provides function implementations for the various declared functions
in the specification, which in turn delegate to an extensible simulation
architecture.</p>
<p>The primary extension point for NVQIR is the <code class="code docutils literal notranslate"><span class="pre">CircuitSimulator</span></code> class. This class
exposes an API that enables qubit allocation and deallocation, quantum operation
invocation, and measurement and sampling. Subtypes of this class are free to
override these methods to affect simulation of the quantum code in any
simulation strategy specific manner (e.g. state vector, tensor network, etc.). Moreover,
subtypes are free to implement simulators that leverage classical accelerated computing.</p>
<p>In this document, we’ll detail this simulator interface and walk through how one
might extend it for new types of simulation.</p>
<section id="circuitsimulator">
<h2>CircuitSimulator<a class="headerlink" href="#circuitsimulator" title="Permalink to this heading">¶</a></h2>
<p>The <code class="code docutils literal notranslate"><span class="pre">CircuitSimulator</span></code> type is defined in <code class="code docutils literal notranslate"><span class="pre">runtime/nvqir/CircuitSimulator.h</span></code>.
It handles a lot of the base functionality required for allocating and deallocated qubits,
as well as measurement, sampling, and observation under a number of execution contexts.</p>
<p>Actual definition of the quantum state data structure, and its overall evolution are
left as tasks for subclasses. Examples of simulation subtypes can be found
in <code class="code docutils literal notranslate"><span class="pre">runtime/nvqir/qpp/QppCircuitSimulator.cpp</span></code> or <code class="code docutils literal notranslate"><span class="pre">runtime/nvqir/custatevec/CuStateVecCircuitSimulator.cpp</span></code>.
The <code class="code docutils literal notranslate"><span class="pre">QppCircuitSimulator</span></code> models the state vector using the <a class="reference external" href="https://github.com/softwareqinc/qpp">Q++</a> library, which
boils down to an <code class="code docutils literal notranslate"><span class="pre">Eigen::Matrix</span></code> type and leverages OpenMP threading for matrix-vector operations.
The <code class="code docutils literal notranslate"><span class="pre">CuStateVecCircuitSimulator</span></code> type models the state vector on an NVIDIA GPU device
by leveraging the cuQuantum library.</p>
<p>The key methods that need to be overridden by subtypes of <code class="code docutils literal notranslate"><span class="pre">CircuitSimulator</span></code> are as follows:</p>
<table class="docutils align-default" id="id1">
<caption><span class="caption-text">Required Circuit Simulator Subtype Method Overrides</span><a class="headerlink" href="#id1" title="Permalink to this table">¶</a></caption>
<tbody>
<tr class="row-odd"><td><p>Method Name</p></td>
<td><p>Method Arguments</p></td>
<td><p>Method Description</p></td>
</tr>
<tr class="row-even"><td><p><code class="code docutils literal notranslate"><span class="pre">addQubitToState</span></code></p></td>
<td><p><code class="code docutils literal notranslate"><span class="pre">void</span></code></p></td>
<td><p>Add a qubit to the underlying state representation.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="code docutils literal notranslate"><span class="pre">resetQubit</span></code></p></td>
<td><p><code class="code docutils literal notranslate"><span class="pre">qubitIdx</span> <span class="pre">:</span> <span class="pre">std::size_t</span></code></p></td>
<td><p>Reset the state of the qubit at the given index to <code class="code docutils literal notranslate"><span class="pre">|0&gt;</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="code docutils literal notranslate"><span class="pre">resetQubitStateImpl</span></code></p></td>
<td><p><code class="code docutils literal notranslate"><span class="pre">void</span></code></p></td>
<td><p>Clear the entire state representation (reset to 0 qubits).</p></td>
</tr>
<tr class="row-odd"><td><p>Quantum Operation Methods</p></td>
<td><p>varies per overload - target qubit index, control qubit index (indices), rotation parameters</p></td>
<td><p>Apply the unitary described by the operation with given method name. (e.g. h(qubitIdx), apply hadamard on qubit with index qubitIdx)</p></td>
</tr>
<tr class="row-even"><td><p><code class="code docutils literal notranslate"><span class="pre">measureQubit</span></code></p></td>
<td><p><code class="code docutils literal notranslate"><span class="pre">qubitIdx</span> <span class="pre">:</span> <span class="pre">std::size_t</span> <span class="pre">-&gt;</span> <span class="pre">bool</span></code> (returns bit result as bool)</p></td>
<td><p>Measure the qubit, produce a bit result, collapse the state.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="code docutils literal notranslate"><span class="pre">sample</span></code></p></td>
<td><p>qubitIdxs : std::vector&lt;std::size_t&gt;, shots : int</p></td>
<td><p>Sample the current multi-qubit state on the provided qubit indices over a certain number of shots</p></td>
</tr>
<tr class="row-even"><td><p><code class="code docutils literal notranslate"><span class="pre">name</span></code></p></td>
<td><p><code class="code docutils literal notranslate"><span class="pre">void</span></code></p></td>
<td><p>Return the name of this CircuitSimulator, must be the same as the name used in <code class="code docutils literal notranslate"><span class="pre">nvq++</span> <span class="pre">-qpu</span> <span class="pre">NAME</span> <span class="pre">...</span></code></p></td>
</tr>
</tbody>
</table>
<p>The strategy for extending this class is to create a new <code class="code docutils literal notranslate"><span class="pre">cpp</span></code> implementation file with the same name as your
subtype class name. In this file, you will subclass the <code class="code docutils literal notranslate"><span class="pre">CircuitSimulator</span></code> and implement the methods in
the above table. Finally, the subclass must be registered with the NVQIR library so that it
can be picked up and used when a user specifies <code class="code docutils literal notranslate"><span class="pre">nvq++</span> <span class="pre">-qpu</span> <span class="pre">mySimulator</span> <span class="pre">...</span></code> from the command line (or <code class="code docutils literal notranslate"><span class="pre">cudaq.set_qpu('mySimulator')</span></code> in Python.)
Type registration can be performed with a provided NVQIR macro</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">NVQIR_REGISTER_SIMULATOR</span><span class="p">(</span><span class="n">MySimulatorClassName</span><span class="p">,</span><span class="w"> </span><span class="n">mySimulator</span><span class="p">)</span>
</pre></div>
</div>
<p>where <code class="code docutils literal notranslate"><span class="pre">MySimulatorClassName</span></code> is the name of your subtype, and <code class="code docutils literal notranslate"><span class="pre">mySimulator</span></code> is the
same name as what <code class="code docutils literal notranslate"><span class="pre">MySimulatorClassName::name()</span></code> returns, and what you desire the
<code class="code docutils literal notranslate"><span class="pre">-qpu</span> <span class="pre">NAME</span></code> name to be.</p>
<p>A further requirement is that the code be compiled into its own standalone shared library
with name <code class="code docutils literal notranslate"><span class="pre">libnvqir-NAME.{so,dylib}</span></code>, where NAME is the
same name as what <code class="code docutils literal notranslate"><span class="pre">MySimulatorClassName::name()</span></code> returns, and what you desire the
<code class="code docutils literal notranslate"><span class="pre">-qpu</span> <span class="pre">NAME</span></code> name to be. You will also need to create a <code class="code docutils literal notranslate"><span class="pre">NAME.config</span></code> file that
contains the following contents</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">NVQIR_SIMULATION_BACKEND</span><span class="o">=</span><span class="s2">&quot;NAME&quot;</span>
</pre></div>
</div>
<p>The library must be installed in <code class="code docutils literal notranslate"><span class="pre">$CUDA_QUANTUM_PATH/lib</span></code> and the configuration file
must be installed to <code class="code docutils literal notranslate"><span class="pre">$CUDA_QUANTUM_PATH/platforms</span></code>.</p>
</section>
<section id="let-s-see-this-in-action">
<h2>Let’s see this in action<a class="headerlink" href="#let-s-see-this-in-action" title="Permalink to this heading">¶</a></h2>
<p>CUDA Quantum provides some CMake utilities to make the creation of your new simulation library
easier. Specifically, but using <code class="code docutils literal notranslate"><span class="pre">find_package(NVQIR)</span></code>, you’ll get access to a <code class="code docutils literal notranslate"><span class="pre">nvqir_add_backend</span></code> function
that will automate a lot of the boilerplate for creating your library and config file.</p>
<p>Let’s assume you want a simulation subtype named <code class="code docutils literal notranslate"><span class="pre">MySimulator</span></code>. You can create a folder or
repository for this code called <code class="code docutils literal notranslate"><span class="pre">my-simulator</span></code> and add <code class="code docutils literal notranslate"><span class="pre">MySimulator.cpp</span></code> and
<code class="code docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> files. Fill the CMake file with the following</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">cmake_minimum_required</span><span class="p">(</span><span class="s">VERSION</span><span class="w"> </span><span class="s">3.18</span><span class="w"> </span><span class="s">FATAL_ERROR</span><span class="p">)</span>
<span class="nb">project</span><span class="p">(</span><span class="s">DemoCreateNVQIRBackend</span><span class="w"> </span><span class="s">VERSION</span><span class="w"> </span><span class="s">1.0.0</span><span class="w"> </span><span class="s">LANGUAGES</span><span class="w"> </span><span class="s">CXX</span><span class="p">)</span>
<span class="nb">find_package</span><span class="p">(</span><span class="s">NVQIR</span><span class="w"> </span><span class="s">REQUIRED</span><span class="p">)</span>
<span class="nb">nvqir_add_backend</span><span class="p">(</span><span class="s">MySimulator</span><span class="w"> </span><span class="s">MySimulator.cpp</span><span class="p">)</span>
</pre></div>
</div>
<p>and then fill out your <code class="code docutils literal notranslate"><span class="pre">MySimulator.cpp</span></code> file with your subtype implementation, something like</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;CircuitSimulator.h&quot;</span>

<span class="k">namespace</span><span class="w"> </span><span class="p">{</span>

<span class="w">  </span><span class="k">class</span><span class="w"> </span><span class="nc">MySimulator</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">nvqir</span><span class="o">::</span><span class="n">CircuitSimulator</span><span class="w"> </span><span class="p">{</span>

<span class="w">  </span><span class="k">protected</span><span class="o">:</span>
<span class="w">    </span><span class="c1">/// @brief Grow the state vector by one qubit.</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">addQubitToState</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="c1">/// @brief Reset the qubit state.</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">resetQubitStateImpl</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">}</span>

<span class="w">  </span><span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="n">MySimulator</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">default</span><span class="p">;</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="o">~</span><span class="n">MySimulator</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">default</span><span class="p">;</span>

<span class="w">  </span><span class="c1">/// The one-qubit overrides</span>
<span class="w">  </span><span class="cp">#define ONE_QUBIT_METHOD_OVERRIDE(NAME)                                        \</span>
<span class="cp">    using CircuitSimulator::NAME;                                                \</span>
<span class="cp">    virtual void NAME(std::vector&lt;std::size_t&gt; &amp;controls, std::size_t &amp;qubitIdx) \</span>
<span class="cp">        override { ... }</span>

<span class="w">  </span><span class="n">ONE_QUBIT_METHOD_OVERRIDE</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="w">  </span><span class="n">ONE_QUBIT_METHOD_OVERRIDE</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<span class="w">  </span><span class="n">ONE_QUBIT_METHOD_OVERRIDE</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
<span class="w">  </span><span class="n">ONE_QUBIT_METHOD_OVERRIDE</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
<span class="w">  </span><span class="n">ONE_QUBIT_METHOD_OVERRIDE</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="w">  </span><span class="n">ONE_QUBIT_METHOD_OVERRIDE</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<span class="w">  </span><span class="n">ONE_QUBIT_METHOD_OVERRIDE</span><span class="p">(</span><span class="n">sdg</span><span class="p">)</span>
<span class="w">  </span><span class="n">ONE_QUBIT_METHOD_OVERRIDE</span><span class="p">(</span><span class="n">tdg</span><span class="p">)</span>

<span class="w">  </span><span class="c1">/// The one-qubit parameterized overrides</span>
<span class="w">  </span><span class="cp">#define ONE_QUBIT_ONE_PARAM_METHOD_OVERRIDE(NAME)                         \</span>
<span class="cp">  using CircuitSimulator::NAME;                                             \</span>
<span class="cp">  virtual void NAME(double &amp;angle, std::vector&lt;std::size_t&gt; &amp;controls,      \</span>
<span class="cp">                   std::size_t &amp;qubitIdx) override { ... }</span>

<span class="w">  </span><span class="n">ONE_QUBIT_ONE_PARAM_METHOD_OVERRIDE</span><span class="p">(</span><span class="n">rx</span><span class="p">)</span>
<span class="w">  </span><span class="n">ONE_QUBIT_ONE_PARAM_METHOD_OVERRIDE</span><span class="p">(</span><span class="n">ry</span><span class="p">)</span>
<span class="w">  </span><span class="n">ONE_QUBIT_ONE_PARAM_METHOD_OVERRIDE</span><span class="p">(</span><span class="n">rz</span><span class="p">)</span>
<span class="w">  </span><span class="n">ONE_QUBIT_ONE_PARAM_METHOD_OVERRIDE</span><span class="p">(</span><span class="n">r1</span><span class="p">)</span>
<span class="w">  </span><span class="n">ONE_QUBIT_ONE_PARAM_METHOD_OVERRIDE</span><span class="p">(</span><span class="n">u1</span><span class="p">)</span>

<span class="w">  </span><span class="c1">/// @brief U2 operation</span>
<span class="w">  </span><span class="k">using</span><span class="w"> </span><span class="n">CircuitSimulator</span><span class="o">::</span><span class="n">u2</span><span class="p">;</span>
<span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">u2</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="o">&amp;</span><span class="n">phi</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="o">&amp;</span><span class="n">lambda</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">controls</span><span class="p">,</span>
<span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="w"> </span><span class="o">&amp;</span><span class="n">qubitIdx</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">}</span>

<span class="w">  </span><span class="c1">/// @brief U3 operation</span>
<span class="w">  </span><span class="k">using</span><span class="w"> </span><span class="n">CircuitSimulator</span><span class="o">::</span><span class="n">u3</span><span class="p">;</span>
<span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">u3</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="o">&amp;</span><span class="n">theta</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="o">&amp;</span><span class="n">phi</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="o">&amp;</span><span class="n">lambda</span><span class="p">,</span>
<span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">controls</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="w"> </span><span class="o">&amp;</span><span class="n">qubitIdx</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">}</span>

<span class="w">  </span><span class="c1">/// @brief Swap operation</span>
<span class="w">  </span><span class="k">using</span><span class="w"> </span><span class="n">CircuitSimulator</span><span class="o">::</span><span class="n">swap</span><span class="p">;</span>
<span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">swap</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ctrlBits</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="w"> </span><span class="o">&amp;</span><span class="n">srcIdx</span><span class="p">,</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="w"> </span><span class="o">&amp;</span><span class="n">tgtIdx</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">}</span>

<span class="w">  </span><span class="kt">bool</span><span class="w"> </span><span class="nf">measureQubit</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="w"> </span><span class="n">qubitIdx</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">}</span>

<span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">resetQubit</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="w"> </span><span class="o">&amp;</span><span class="n">qubitIdx</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">}</span>

<span class="w">  </span><span class="n">cudaq</span><span class="o">::</span><span class="n">SampleResult</span><span class="w"> </span><span class="nf">sample</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">measuredBits</span><span class="p">,</span>
<span class="w">                          </span><span class="kt">int</span><span class="w"> </span><span class="n">shots</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">}</span>

<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string_view</span><span class="w"> </span><span class="nf">name</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;MySimulator&quot;</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="p">};</span>

<span class="p">}</span><span class="w"> </span><span class="c1">// namespace</span>

<span class="c1">/// Register this Simulator with NVQIR.</span>
<span class="n">NVQIR_REGISTER_SIMULATOR</span><span class="p">(</span><span class="n">MySimulator</span><span class="p">)</span>
</pre></div>
</div>
<p>To build, install, and use this simulation backend, run the following from the top-level of <code class="code docutils literal notranslate"><span class="pre">my-simulator</span></code></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir<span class="w"> </span>build<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>build
cmake<span class="w"> </span>..<span class="w"> </span>-G<span class="w"> </span>Ninja<span class="w"> </span>-DNVQIR_DIR<span class="o">=</span><span class="s2">&quot;</span><span class="nv">$CUDA_QUANTUM_PATH</span><span class="s2">/lib/cmake/nvqir&quot;</span>
ninja<span class="w"> </span>install
</pre></div>
</div>
<p>Then given any CUDA Quantum source file, you can compile and target your backend simulator with</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>nvq++<span class="w"> </span>file.cpp<span class="w"> </span>--qpu<span class="w"> </span>MySimulator
./a.out
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../advanced.html" class="btn btn-neutral float-left" title="Advanced CUDA Quantum Topics" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="cmake_app.html" class="btn btn-neutral float-right" title="CUDA Quantum and CMake" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, NVIDIA Corporation &amp; Affiliates.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script>  

  <style>
  a:link, a:visited {
    color: #76b900;
  }

  a:hover {
    color: #8c0;
  }

  .rst-content dl:not(.docutils) dt {
    background: rgba(118, 185, 0, 0.1);
    color: rgba(59,93,0,1);
    border-top: solid 3px rgba(59,93,0,1);
  }
  </style>
  

</body>
</html>